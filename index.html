<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Exact Historic Pattern Predictor (Corrected)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#0b0b0b;
  color:#ffffff;
  font-family:Arial, sans-serif;
  padding:12px;
}
h2{
  text-align:center;
  color:#00ffd5;
}
#status{
  text-align:center;
  color:#aaa;
  margin-bottom:10px;
}
.box{
  background:#111;
  padding:12px;
  margin:10px 0;
  border-radius:6px;
  text-align:center;
}
.pred{
  font-size:20px;
  color:#00ff88;
  font-weight:bold;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  padding:6px;
  text-align:center;
  border-bottom:1px solid #222;
}
th{
  color:#00ffd5;
}
.big{color:#00ff00;font-weight:bold}
.small{color:#ffcc00;font-weight:bold}
.red{color:red}
.green{color:lime}
.violet{color:violet}
</style>
</head>

<body>

<h2>Exact Historic Pattern Predictor</h2>
<div id="status">Loading…</div>

<div class="box">
  <b>Recent Pattern (Auto)</b><br>
  <div id="patternView">---</div>
</div>

<div class="box">
  <b>Prediction (From History)</b><br>
  <div id="predictionBox">Waiting…</div>
</div>

<table>
<thead>
<tr>
  <th>Period</th>
  <th>Number</th>
  <th>Size</th>
  <th>Color</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<script>
const API_URL = "https://harshpredictor.site/api/api.php";

// Helpers
const getSize = n => n >= 5 ? "BIG" : "SMALL";

/**
 * CORE LOGIC (CORRECTED)
 * history: array of numbers (oldest → newest)
 * pattern: recent 3 numbers
 */
function historicPatternPredict(history, pattern){
  const pLen = pattern.length;

  // scan from newest match → backwards
  for(let i = history.length - pLen - 1; i >= 1; i--){
    let match = true;

    for(let j = 0; j < pLen; j++){
      if(history[i + j] !== pattern[j]){
        match = false;
        break;
      }
    }

    if(match){
      const prev = history[i - 1];
      const next = history[i + pLen];
      return [prev, next];
    }
  }
  return null;
}

async function load(){
  try{
    document.getElementById("status").innerText = "Fetching live data…";
    const res = await fetch(API_URL,{cache:"no-store"});
    const json = await res.json();
    const list = json?.data?.list;

    if(!Array.isArray(list)){
      document.getElementById("status").innerText = "Invalid API format";
      return;
    }

    // Build historic sequence (oldest → newest)
    const history = list.slice().reverse().map(r => Number(r.number));

    // Recent 3 numbers (latest results)
    const recentPattern = list.slice(0,3).map(r => Number(r.number));

    document.getElementById("patternView").innerText =
      recentPattern.join(",");

    const prediction = historicPatternPredict(history, recentPattern);

    if(prediction){
      document.getElementById("predictionBox").innerHTML =
        `<span class="pred">${prediction.join(" , ")}</span>`;
    }else{
      document.getElementById("predictionBox").innerText =
        "No exact historic match";
    }

    // Display latest 30 rows
    const tb = document.getElementById("tableBody");
    tb.innerHTML="";
    list.slice(0,30).forEach(r=>{
      const colors = r.color.split(",")
        .map(c=>`<span class="${c}">${c}</span>`)
        .join(", ");
      tb.innerHTML += `
        <tr>
          <td>${r.issueNumber}</td>
          <td>${r.number}</td>
          <td class="${getSize(r.number).toLowerCase()}">${getSize(r.number)}</td>
          <td>${colors}</td>
        </tr>`;
    });

    document.getElementById("status").innerText =
      "Updated at " + new Date().toLocaleTimeString();

  }catch(e){
    document.getElementById("status").innerText = "Fetch failed";
    console.error(e);
  }
}

load();
setInterval(load,60000);
</script>

</body>
</html>